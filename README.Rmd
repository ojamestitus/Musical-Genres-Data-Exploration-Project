---
title: "Stat 850 Final Project"
author: "Neetu Regmi, Cassie Tangen, Oliver Titus"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(digits = 3)
```

```{r load-sas-libraries, echo = F, message = F, warning = F}

saspath <- "/usr/local/SASHome/SASFoundation/9.4/bin/sas_en" # Your SAS path goes here
sasopts <- "-ls 75"
knitr::opts_chunk$set(engine.path=list(sas=saspath, saslog=saspath, sashtml=saspath),
                      engine.opts=list(sas=sasopts, saslog=sasopts, sashtml=sasopts), 
                      comment=NA)
library(SASmarkdown)
```


## Introduction

There are a wide range of genres and each genre has its own unique traits that sets it apart from the other genres. We plan to investigate what makes rock, R&B, rap, EDM, latin, and pop different based on their length, danceability, energy, and loudness. We will then analyze the popularity of each genre. Based on their popularities we will look to see which factor plays the most important roll, if any does, in the popularity of songs.



```{r, echo=F, message = F, warning = F}
# load the data
spotify_songs <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-21/spotify_songs.csv')
```

## Data Description

The data we are analyzing was obtained from TidyTuesday. The data was obtained by using the spotifyr package created by Charlie Thompson, Josiah Parry, Donal Phipps, and Tom Wolff. The spotifyr package allows the bulk pulling of features tracks from Spotify’s Web API. Since we are novices at using new packages, we decided just using the data collected by TidyTuesday using spotifyr would be sufficient for our study. We do recognize the fact that there is a potential bias to the data we are analyzing because we are not aware of the search parameters used by TidyTuesday when collecting this data using spotifyr.

In our study we will focus on the danceability, energy, speechiness, popularity, length, and loudness of songs. We will primarily group data based on the song’s genre.

>We need to find a properly cite all of the definitions. (use: https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-01-21)


## Data Summary
We will look at the interesting variables mentioned above for each of the genre to attempt to determine a defining characteristic or two about each genre.

Let's first look at a nice stacked boxplot for each of the variables that we are interested in exploring along with a boxplot of the popularity of each genre. These might give us a visual idea of which variables are key characteristics for each genre.

>Need to include box plots for: duration, danceability, energy, loudness, and speechines and popularity. I have duration, loudness and popularity need to add energy and danceability.

### Visual Exploration of Data


```{r, warning=F, message=F, echo=F}
library(tidyverse)
library(dplyr)
library(knitr)
ggplot(spotify_songs, aes(y=duration_ms, fill=playlist_genre)) + geom_boxplot()
```

```{r, warning=F, message=F, echo=F}
ggplot(spotify_songs, aes(y=loudness, fill=playlist_genre)) + geom_boxplot()
```

```{r, warning=F, message=F, echo=F}
ggplot(spotify_songs, aes(y=danceability, fill=playlist_genre)) + 
    geom_boxplot()
```

```{r, warning=F, message=F, echo=F}
ggplot(spotify_songs, aes(y=energy, fill=playlist_genre)) + 
    geom_boxplot()
```

```{r, warning=F, message=F, echo=F}
ggplot(spotify_songs, aes(y=speechiness, fill=playlist_genre)) + 
    geom_boxplot()
```

```{r, warning=F, message=F, echo=F}
ggplot(spotify_songs, aes(y=track_popularity, fill=playlist_genre)) + geom_boxplot()
```

It appears that rock and R&B have the longest durations and EDM is the shortest.
EDM appears to be the loudest with R&B the least loud. Let's look at the means numerically as well.
It appears that pop and latin on average are more popular and EDM is the least popular.


> We will want to make some comments about each of these boxplots before moving on to some nice summary statistics.

### Summary Statistics
Let's look closer by looking numerically at our data. I'm also curious about how many songs there are for each genre so I am going to find the number of songs in each genre now as well. The number of tracks could have an impact on the popularity of the genre. Below we have a table that nicely shows summary statistics for our data.


> For our summary statistics we should organize everything in one tibble together then I believe Oliver said he can make it look pretty?
If we could put everything that Oliver has down below for danceability, energy, and speechiness into the same tibble as I (Cassie) have going here that would work towards the cohesiveness of the project.



```{r, warning=F, message=F, echo=F}
#creating the data frames that we used later on to make the calculations easier.

#not sure we actually use this later on at this point, but I'm going to leave it here for now. If we don't need it someone can move it to the bottom until we finalize our project.

spotify_songs_edm<-filter(spotify_songs, playlist_genre=="edm")
spotify_songs_latin<-filter(spotify_songs, playlist_genre=="latin")
spotify_songs_pop<-filter(spotify_songs, playlist_genre=="pop")
spotify_songs_rb<-filter(spotify_songs, playlist_genre=="r&b")
spotify_songs_rap<-filter(spotify_songs, playlist_genre=="rap")
spotify_songs_rock<-filter(spotify_songs, playlist_genre=="rock")

```

>Here is a good option for a summary table with all of the means
Oliver could you make this look pretty?

```{r, warning=F, message=F, echo=F}
summary_table<- group_by(spotify_songs, playlist_genre) %>% summarise(count=n(), mean_loudness=mean(loudness), mean_duration_in_ms=mean(duration_ms), mean_danceability=mean(danceability), mean_speechiness=mean(speechiness), mean_energry=mean(energy), mean_mean_popularity=mean(track_popularity))
summary_table %>% kable()
```


## Results

```{r}
speechiness_aov <- aov(speechiness ~ playlist_genre, data=spotify_songs)
energy_aov <- aov(energy ~ playlist_genre, data=spotify_songs)
danceability_aov <- aov(danceability ~ playlist_genre, data=spotify_songs)
loudness_aov <- aov(loudness ~ playlist_genre, data=spotify_songs)
duration_aov <- aov(duration_ms ~ playlist_genre, data=spotify_songs)
popularity_aov <- aov(track_popularity ~ playlist_genre, data=spotify_songs)

summary(speechiness_aov)
summary(energy_aov)
summary(danceability_aov)
summary(loudness_aov)
summary(duration_aov)
summary(popularity_aov)

```

>Since the Anova tests above all result in rejecting the null hypothesis that all of the groups have equal means we should perform a tukey test to see which is different. 

All of the above overall F-tests reject the null hypothesis that the mean speechiness, energy, danceability, loudness, duration, and popularity are the same. This means that there is a difference with all of these characteristics across each genre. We will investigate the size of these differences using a Tukey test.

```{r}
TukeyHSD(speechiness_aov)
TukeyHSD(energy_aov)
TukeyHSD(danceability_aov)
TukeyHSD(loudness_aov)
TukeyHSD(duration_aov)
TukeyHSD(popularity_aov)

```

>We will want to talk about the results of both the ANOVA and the Tukey tests.



> This section has the relationships between popularity and the characteristics that we were interested in looking at. We should have both scatterplots and some sort of hypothesis test.


## Explore the relationship between popularity and each of the following: danceability, energy, speechiness, length, and loudness. 
## Danceability
```{r}
ggplot(spotify_songs, aes(x=danceability, y=track_popularity)) + 
    geom_point()+geom_smooth(method=lm)

```

```{r}
summary(lm(data=spotify_songs, track_popularity~danceability))
```
From the scatterplot, there appears to be no significant relationship between danceability and track popularity.Since our r squared value is close to zero,the variation observed in track popularity is not explained by danceability. 

## Energy
```{r}
ggplot(spotify_songs, aes(x=energy, y=track_popularity)) + 
    geom_point()+geom_smooth(method=lm)

```

```{r}
summary(lm(data=spotify_songs, track_popularity~energy))
```
From the scatterplot, there appears to be slightly negative relationship between track popularity and energy but variation in track popularity is not explained by energy as we see r squared value is close to zero.

##speechiness
```{r}
ggplot(spotify_songs, aes(x=speechiness, y=track_popularity)) + 
    geom_point()+geom_smooth(method=lm)
```
```{r}
summary(lm(data=spotify_songs, track_popularity~speechiness))
```
From the scatterplot, it appears that there is no significant relationship between track popularity and speechiness. As we can see any variation in track popularity cannot be explained by speechiness since r squared is almost close to 0. 

## Length(duration)

```{r}
ggplot(spotify_songs, aes(x=duration_ms, y=track_popularity)) + 
    geom_point()+geom_smooth(method=lm)

```

```{r}
summary(lm(data=spotify_songs, track_popularity~duration_ms))
```
This scatterplot shows that there is a negative relationship between duration of song and track popularity but since r squared value is close to zero 

## Loudness
```{r}
ggplot(spotify_songs, aes(x=loudness, y=track_popularity)) + 
    geom_point()+geom_smooth(method=lm)
```

```{r}
summary(lm(data=spotify_songs, track_popularity~loudness))
```
There appears to be no significant relationship between track popularity and loudness since our r squared value is closer to zero, most of variation is not explained by the loudness which suggests that there might other variables at play.

## Group Members
Neetu Regmi 
Oliver Titus 
Cassie Tangen

## References:
TidyTuesday: https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-01-21

Spotifyr: https://www.rcharlie.com/spotifyr/


## Code from our rough draft that we may not need for our final paper.

1.Explore the relationship between playlist subgenre and track popularity .

```{r}
library(ggthemes)
ggplot(spotify_songs, aes(x=playlist_subgenre, y=track_popularity)) + 
  geom_point(size = 2,color="orange") + 
  geom_segment(aes(x=playlist_subgenre, 
                   xend=playlist_subgenre, 
                   y=0, 
                   yend=track_popularity)) + 
  labs(title="Lollipop Chart", 
       subtitle="Popularity of song on spotify", 
       caption="source: Spotify data") + 
  theme(axis.text.x = element_text(angle=80, vjust=0.6))
```
Some extra info on the values of track popularity:The score is received from the Spotify API. The value will be between 0 and 100, with 100 being the most popular.The popularity is calculated by algorithm and is based, in the most part, on the total number of plays the track has had and how recent those plays are.
From the above chart, It seems that most of the playlist subgenere popularity lies between 75 and 100. Some of those are dance pop, post-teen pop, pop edm, latin hip hop, hip hop while the lowest popularity are around 75  like new jack swing, hard rock. I would say according to the chart popularity of song among subgenre are not extremely varied. 


2.Explore a potential relationship between mode and song key.

> You'll need to clean this data. Key should be A, B, C, D, E, F, G + flat/sharp. The numbers likely are factor categories, and you probably need the label. See the tidytuesday documentation

> Similarly, mode is also likely to be categorical: https://en.wikipedia.org/wiki/Mode_(music). From looking at the documentation, it appears they're misusing the term mode to represent major (1) or minor(0). If that's the case, you might have better luck looking at the mode as it relates to genre - certain genres are much more likely to use minor keys (they have a sad, haunting sound, usually), where I'd assume pop and other upbeat stuff would be more likely to use a major key.



```{r}
p1 <- ggplot() + 
    geom_line(aes(y = key, x = mode), data = spotify_songs,col="orange") +
    theme(text=element_text(family="Tahoma"))
p1 + labs(title = "Relationship between key and mode", x = "mode", y = "key", caption = "Data: spotify")
```
This chart shows the relationship that for mode 0 and 1, the key varies. By looking at the vertical line, we could say that variability within mode 0 and 1 looks similar because they both vary on different value of key.

> You're plotting this as a numeric variable when neither variable is actually numeric. Please revise and treat this as a categorical variable!

##Relationship between dancebaility and energy
 
```{r}
ggplot(spotify_songs, aes(x=danceability, y=energy)) + 
    geom_hex() + scale_fill_continuous(trans = "log10")
```
This scatterplot shows the relationship between danceability and energy also we can see that highest number of observation falls around when both danceability and energy are above 0.50.This suggests that we can expect that high value of danceability will likely have high value of energy ignoring some outliers.
Also, I wanted to circle the region that has large number of points cluster together, tried few things to get some sort of outline to focus on that region didn't work, was unsuccessful.

3. Explore the relationship between danceability and tempo.

```{r}
ggplot(spotify_songs, aes(x=tempo, y=danceability)) + 
    geom_point() + geom_smooth(method=lm)
```

```{r}
summary(lm(data=spotify_songs, danceability~tempo))
```

According to this regression output, there appears to be a significant negative relationship between danceability and tempo because of the negative and significant coeffiecient on loudness. But, the R^2 is quite small, so most of the variability in danceability is not explained by tempo. This is also apparent in the scatter plot.

2. Explore the relationship between danceability and loudness.

```{r}
ggplot(spotify_songs, aes(x=loudness, y=danceability)) + 
    geom_point() + geom_smooth(method=lm)
```

```{r}
summary(lm(data=spotify_songs, danceability~loudness))
```

Looking at the scatter plot, there appears to be no significant relationship between loudness and danceability because of the coefficient on loudness and the R^2 being almost 0.

## Summary statistics for danceability for each genre:

### EDM
```{r, warning=F, message=F, echo=F}
summary(spotify_songs_edm$danceability)

```
### Latin

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_latin$danceability)
```

### Pop

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_pop$danceability)
```

### R&B
```{r, warning=F, message=F, echo=F}
summary(spotify_songs_rb$danceability)
```

### Rap

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_rap$danceability)
```

### Rock

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_rock$danceability)
```

We see that rap has the highest mean danceability and rock has the lowest mean danceabiltiy according the summary statistics and the box plot.


## Summary statistics for energy for each genre:

### EDM
```{r, warning=F, message=F, echo=F}
summary(spotify_songs_edm$energy)
```
### Latin

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_latin$energy)
```

### Pop

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_pop$energy)
```

### R&B
```{r, warning=F, message=F, echo=F}
summary(spotify_songs_rb$energy)
```

### Rap

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_rap$energy)
```

### Rock

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_rock$energy)
```

EDM appears has the highest mean energy according to the summary statistics and box plot, and R&B has the lowest mean energy.


## Summary statistics for speechiness for each genre:

### EDM
```{r, warning=F, message=F, echo=F}
summary(spotify_songs_edm$speechiness)
```
### Latin

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_latin$speechiness)
```

### Pop

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_pop$speechiness)
```

### R&B
```{r, warning=F, message=F, echo=F}
summary(spotify_songs_rb$speechiness)
```

### Rap

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_rap$speechiness)
```

### Rock

```{r, warning=F, message=F, echo=F}
summary(spotify_songs_rock$speechiness)
```

Every genre seems to have a very similar amount of speechiness, although rap seems to have significantly higher mean speechiness than the other genres.


```{r, warning=F, message=F, echo=F}
#Find out how many tracks there are for each genre. This may be useful later as we look at each of the characteristics.
count_edm<-as.double(count(spotify_songs_edm))
count_latin<-as.double(count(spotify_songs_latin))
count_pop<-as.double(count(spotify_songs_pop))
count_rb<-as.double(count(spotify_songs_rb))
count_rap<-as.double(count(spotify_songs_rap))
count_rock<-as.double(count(spotify_songs_rock))

#It is nice to put things into a list so that we can add them to the tibble later on.
count<-c(count_edm,count_latin,count_pop,count_rb,count_rap,count_rock)
```

> Some of this would be a lot easier if you use group_by! Right now you're doing it by hand!



> This tibble that I made here should be made pretty. I think Oliver said he could do that? - C

```{r, warning=F, message=F, echo=F}
# find mean duration in ms then change to min by /1.667*10^{-5}

mean_duration_edm<-mean(spotify_songs_edm$duration_ms)
mean_duration_latin<-mean(spotify_songs_latin$duration_ms)
mean_duration_pop<-mean(spotify_songs_pop$duration_ms)
mean_duration_rb<-mean(spotify_songs_rb$duration_ms)
mean_duration_rap<-mean(spotify_songs_rap$duration_ms)
mean_duration_rock<-mean(spotify_songs_rock$duration_ms)

mean_duration<-c(mean_duration_edm/1.667*10^{-5},mean_duration_latin/1.667*10^{-5},mean_duration_pop/1.667*10^{-5},mean_duration_rb/1.667*10^{-5},mean_duration_rap/1.667*10^{-5},mean_duration_rock/1.667*10^{-5})

genre<-c("EDM","Latin","Pop","R&B","Rap","Rock")

genre_table<-tibble(genre,mean_duration)
#instead of printing this tibble we will want to have a pretty table with all of the summary statistics together.
#print(genre_table)

```

It appears that the genre with the longest songs is rock and the genre with the shortest songs is rap. Would be interesting to perform a hypothesis test to see if there is a statitical difference between the lengths of songs.

Let's go ahead and calculate mean popularity and add it to the genre table

```{r, warning=F, message=F, echo=F}
mean_popularity_edm<-mean(spotify_songs_edm$track_popularity)
mean_popularity_latin<-mean(spotify_songs_latin$track_popularity)
mean_popularity_pop<-mean(spotify_songs_pop$track_popularity)
mean_popularity_rb<-mean(spotify_songs_rb$track_popularity)
mean_popularity_rap<-mean(spotify_songs_rap$track_popularity)
mean_popularity_rock<-mean(spotify_songs_rock$track_popularity)

mean_popularity<-c(mean_popularity_edm,mean_popularity_latin,mean_popularity_pop,mean_popularity_rb,mean_popularity_rap,mean_popularity_rock)


genre_table<-tibble(genre,mean_duration)%>% mutate(mean_popularity)%>%mutate(count)
#print(genre_table)
```
It appears that EDM is the least popular on average, but it has the most songs so that could be impacting the popularity. I would be interested in performing a hypothesis test to see if EDM's mean popularity is statistically different than that of the others that all appear to be roughly the same popularity-wise.



```{r, warning=F, message=F, echo=F}
mean_loud_edm<-mean(spotify_songs_edm$loudness)
mean_loud_latin<-mean(spotify_songs_latin$loudness)
mean_loud_pop<-mean(spotify_songs_pop$loudness)
mean_loud_rb<-mean(spotify_songs_rb$loudness)
mean_loud_rap<-mean(spotify_songs_rap$loudness)
mean_loud_rock<-mean(spotify_songs_rock$loudness)

mean_loudness<-c(mean_loud_edm,mean_loud_latin,mean_loud_pop,mean_loud_rb,mean_loud_rap,mean_loud_rock)

genre_table<-tibble(genre,mean_duration)%>% mutate(mean_popularity)%>%mutate(mean_loudness)%>%mutate(count)
#print(genre_table)
```
It seems R&B is the least loud and EDM is the loudest. There is not a huge spread between genre's for loudness, but it does seem that EDM is a decent amount louder than the other varieties. I would be interesting in running a hypothesis test here as well.

