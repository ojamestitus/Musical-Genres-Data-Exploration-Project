---
title: "Stat 850 Final Project"
author: "Neetu Regmi, Cassie Tangen, Oliver Titus"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(digits = 3)
```

```{r load-sas-libraries, echo = F, message = F, warning = F}

saspath <- "/usr/local/SASHome/SASFoundation/9.4/bin/sas_en" # Your SAS path goes here
sasopts <- "-ls 75"
knitr::opts_chunk$set(engine.path=list(sas=saspath, saslog=saspath, sashtml=saspath),
                      engine.opts=list(sas=sasopts, saslog=sasopts, sashtml=sasopts), 
                      comment=NA)
library(SASmarkdown)
```


## Introduction

There are a wide range of genres and each genre has its own unique traits that sets it apart from the other genres. We plan to investigate what makes rock, R&B, rap, EDM, latin, and pop different based on their length, danceability, energy, and loudness. We will then analyze the popularity of each genre. Based on their popularities we will look to see which factor plays the most important roll, if any does, in the popularity of songs.



```{r, echo=F, message = F, warning = F}
# load the data
spotify_songs <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-21/spotify_songs.csv')
```

## Data Description

The data we are analyzing was obtained from TidyTuesday. The data was obtained by using the spotifyr package created by Charlie Thompson, Josiah Parry, Donal Phipps, and Tom Wolff. The spotifyr package allows the bulk pulling of features tracks from Spotify’s Web API. Since we are novices at using new packages, we decided just using the data collected by TidyTuesday using spotifyr would be sufficient for our study. We do recognize the fact that there is a potential bias to the data we are analyzing because we are not aware of the search parameters used by TidyTuesday when collecting this data using spotifyr.

In our study we will focus on the danceability, energy, speechiness, popularity, length, and loudness of songs. We will primarily group data based on the song’s genre.

>We need to find a properly cite all of the definitions. (use: https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-01-21)


## Data Summary
We will look at the interesting variables mentioned above for each of the genre to attempt to determine a defining characteristic or two about each genre.

Let's first look at a nice stacked boxplot for each of the variables that we are interested in exploring along with a boxplot of the popularity of each genre. These might give us a visual idea of which variables are key characteristics for each genre.

### Visual Exploration of Data

```{r, warning=F, message=F, echo=F}
library(tidyverse)
library(dplyr)
library(knitr)
library(broom)
library(moderndive)
ggplot(spotify_songs, aes(y=duration_ms, fill=playlist_genre)) + geom_boxplot() + ggtitle("Duration for each Genre") + ylab("Milliseconds (ms)") + scale_fill_discrete(name = "Genre", labels = c("EDM", "Latin", "Pop", "R&B", "Rap", "Rock"))
```

```{r, warning=F, message=F, echo=F}
ggplot(spotify_songs, aes(y=loudness, fill=playlist_genre)) + geom_boxplot() + ggtitle("Loudness for each Genre") + ylab("Decibals (dB)") + scale_fill_discrete(name = "Genre", labels = c("EDM", "Latin", "Pop", "R&B", "Rap", "Rock"))
```

```{r, warning=F, message=F, echo=F}
ggplot(spotify_songs, aes(y=danceability, fill=playlist_genre)) + ggtitle("Danceability for each Genre") + geom_boxplot() + ylab("Danceability") + scale_fill_discrete(name = "Genre", labels = c("EDM", "Latin", "Pop", "R&B", "Rap", "Rock"))
```

```{r, warning=F, message=F, echo=F}
ggplot(spotify_songs, aes(y=energy, fill=playlist_genre)) + 
    geom_boxplot() + ggtitle("Energy for each Genre") + ylab("Energy") + scale_fill_discrete(name = "Genre", labels = c("EDM", "Latin", "Pop", "R&B", "Rap", "Rock"))
```

```{r, warning=F, message=F, echo=F}
ggplot(spotify_songs, aes(y=speechiness, fill=playlist_genre)) + 
    geom_boxplot() + ggtitle("Speechiness for each Genre") + ylab("Speechiness") + scale_fill_discrete(name = "Genre", labels = c("EDM", "Latin", "Pop", "R&B", "Rap", "Rock"))
```

```{r, warning=F, message=F, echo=F}
ggplot(spotify_songs, aes(y=track_popularity, fill=playlist_genre)) + geom_boxplot() + ggtitle("Popularity for each Genre") + ylab("Track Popularity") + scale_fill_discrete(name = "Genre", labels = c("EDM", "Latin", "Pop", "R&B", "Rap", "Rock"))
```

It appears that rock and R&B have the longest durations and EDM is the shortest.
EDM appears to be the loudest with R&B the least loud. Let's look at the means numerically as well.
It appears that pop and latin on average are more popular and EDM is the least popular.


> We will want to make some comments about each of these boxplots before moving on to some nice summary statistics.

### Summary Statistics
Let's look closer by looking numerically at our data. I'm also curious about how many songs there are for each genre so I am going to find the number of songs in each genre now as well. The number of tracks could have an impact on the popularity of the genre. Below we have a table that nicely shows summary statistics for our data.



```{r, warning=F, message=F, echo=F}
#creating the data frames that we used later on to make the calculations easier.

#not sure we actually use this later on at this point, but I'm going to leave it here for now. If we don't need it someone can move it to the bottom until we finalize our project.

spotify_songs_edm<-filter(spotify_songs, playlist_genre=="edm")
spotify_songs_latin<-filter(spotify_songs, playlist_genre=="latin")
spotify_songs_pop<-filter(spotify_songs, playlist_genre=="pop")
spotify_songs_rb<-filter(spotify_songs, playlist_genre=="r&b")
spotify_songs_rap<-filter(spotify_songs, playlist_genre=="rap")
spotify_songs_rock<-filter(spotify_songs, playlist_genre=="rock")

```


```{r, warning=F, message=F, echo=F}
summary_table<- group_by(spotify_songs, playlist_genre) %>% summarise(count=n(), mean_loudness=mean(loudness), mean_duration_in_ms=mean(duration_ms), mean_danceability=mean(danceability), mean_speechiness=mean(speechiness), mean_energry=mean(energy), mean_mean_popularity=mean(track_popularity))
summary_table %>% kable()
```


## Results

```{r}
speechiness_aov <- aov(speechiness ~ playlist_genre, data=spotify_songs)
energy_aov <- aov(energy ~ playlist_genre, data=spotify_songs)
danceability_aov <- aov(danceability ~ playlist_genre, data=spotify_songs)
loudness_aov <- aov(loudness ~ playlist_genre, data=spotify_songs)
duration_aov <- aov(duration_ms ~ playlist_genre, data=spotify_songs)
popularity_aov <- aov(track_popularity ~ playlist_genre, data=spotify_songs)
```

### ANOVA for Speechiness

```{r}
tidy(speechiness_aov) %>% kable()
```

### ANOVA for Energy

```{r}
tidy(energy_aov) %>% kable()
```

### ANOVA for Danceability

```{r}
tidy(danceability_aov) %>% kable()
```

### ANOVA for Loudness

```{r}
tidy(loudness_aov) %>% kable()
```

### ANOVA for Duration

```{r}
tidy(duration_aov) %>% kable()
```

### ANOVA for Popularity

```{r}
tidy(popularity_aov) %>% kable
```


All of the above overall F-tests reject the null hypothesis that the mean speechiness, energy, danceability, loudness, duration, and popularity are the same. This means that there is a difference with all of these characteristics across each genre. We will investigate the size of these differences using a Tukey test.

### Tukey Test for Speechiness
```{r}
tidy(TukeyHSD(speechiness_aov)) %>% kable()
```

### Tukey Test for Energy

```{r}
tidy(TukeyHSD(energy_aov)) %>% kable()
```

### Tukey Test for Danceability

```{r}
tidy(TukeyHSD(danceability_aov)) %>% kable()
```

### Tukey Test for Loudness

```{r}
tidy(TukeyHSD(loudness_aov)) %>% kable()
```

### Tukey Test for Duration

```{r}
tidy(TukeyHSD(duration_aov)) %>% kable()
```

### Tukey Test for Popularity

```{r}
tidy(TukeyHSD(popularity_aov)) %>% kable()
```

>We will want to talk about the results of both the ANOVA and the Tukey tests.


## Explore the relationship between popularity and each of the following: danceability, energy, speechiness, length, and loudness. 
## Danceability
```{r, message=FALSE}
ggplot(spotify_songs, aes(x=danceability, y=track_popularity)) + 
    geom_point()+geom_smooth(method=lm) + ggtitle("Track Popularity vs. Danceability") + xlab("Danceability") + ylab("Track Popularity")

```

### Regression Output

```{r}
danceability_model <- lm(data=spotify_songs, track_popularity~danceability)
get_regression_table(danceability_model) %>% kable()
get_regression_summaries(danceability_model) %>% kable()
```
From the scatterplot, there appears to be no significant relationship between danceability and track popularity.Since our r squared value is close to zero,the variation observed in track popularity is not explained by danceability. 

## Energy
```{r, message=FALSE}
ggplot(spotify_songs, aes(x=energy, y=track_popularity)) + 
    geom_point()+geom_smooth(method=lm) + ggtitle("Track Popularity vs. Energy") + xlab("Energy") + ylab("Track Popularity")

```

### Regression Output

```{r}
energy_model <- lm(data=spotify_songs, track_popularity~energy)
get_regression_table(energy_model) %>% kable()
get_regression_summaries(energy_model) %>% kable()
```
From the scatterplot, there appears to be slightly negative relationship between track popularity and energy but variation in track popularity is not explained by energy as we see r squared value is close to zero.

## Speechiness
```{r, message=FALSE}
ggplot(spotify_songs, aes(x=speechiness, y=track_popularity)) + 
    geom_point()+geom_smooth(method=lm) + ggtitle("Track Popularity vs. Speechiness") + xlab("Speechiness") + ylab("Track Popularity")
```

### Regression Output

```{r}
speechiness_model <- lm(data=spotify_songs, track_popularity~speechiness)
get_regression_table(speechiness_model) %>% kable()
get_regression_summaries(speechiness_model) %>% kable()
```
From the scatterplot, it appears that there is no significant relationship between track popularity and speechiness. As we can see any variation in track popularity cannot be explained by speechiness since r squared is almost close to 0. 

## Length (duration)

```{r, message=FALSE}
ggplot(spotify_songs, aes(x=duration_ms, y=track_popularity)) + 
    geom_point()+geom_smooth(method=lm) + ggtitle("Track Popularity vs. Duration") + xlab("Milliseconds (ms)") + ylab("Track Popularity")
```

### Regression Output

```{r}
duration_model <- lm(data=spotify_songs, track_popularity~duration_ms)
get_regression_table(duration_model) %>% kable()
get_regression_summaries(duration_model) %>% kable()
```
This scatterplot shows that there is a negative relationship between duration of song and track popularity but since r squared value is close to zero 

## Loudness
```{r, message=FALSE}
ggplot(spotify_songs, aes(x=loudness, y=track_popularity)) + 
    geom_point()+geom_smooth(method=lm) + ggtitle("Track Popularity vs. Loudness") + xlab("Decibals (dB)") + ylab("Track Popularity")
```

### Regression Output

```{r}
loudness_model <- lm(data=spotify_songs, track_popularity~loudness)
get_regression_table(loudness_model) %>% kable()
get_regression_summaries(loudness_model) %>% kable()
```
There appears to be no significant relationship between track popularity and loudness since our r squared value is closer to zero, most of variation is not explained by the loudness which suggests that there might other variables at play.

## Group Members
Neetu Regmi 
Oliver Titus 
Cassie Tangen

## References:
TidyTuesday: https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-01-21

Spotifyr: https://www.rcharlie.com/spotifyr/